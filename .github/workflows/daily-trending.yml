name: GitHub Trending Daily

on:
  schedule:
    - cron: '0 0 * * *' # æ¯å¤© 00:00 UTC æ‰§è¡Œ (åŒ—äº¬æ—¶é—´ 08:00)
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  send-trending:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run trending script
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          # ğŸ“Œ è‡ªå®šä¹‰æ¨¡å‹é…ç½®ï¼ˆå¯é€‰ï¼‰
          # å¦‚æœä½¿ç”¨é Anthropic å®˜æ–¹æ¨¡å‹ï¼Œå¯ä»¥é…ç½®ä»¥ä¸‹å˜é‡ï¼š
          # ANTHROPIC_BASE_URL: ${{ secrets.ANTHROPIC_BASE_URL }}
          # ANTHROPIC_MODEL: ${{ secrets.ANTHROPIC_MODEL }}
          
          # ===========================================
          # é‚®ä»¶æœåŠ¡é…ç½®
          # ===========================================
          
          # æ–¹å¼1ï¼šä½¿ç”¨ Resend APIï¼ˆæ¨èï¼‰
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          RESEND_FROM_EMAIL: ${{ secrets.RESEND_FROM_EMAIL }}
          RESEND_TO_EMAIL: ${{ secrets.RESEND_TO_EMAIL }}
          
          # æ–¹å¼2ï¼šä½¿ç”¨ SMTPï¼ˆå¦‚ 163ã€QQ é‚®ç®±ï¼‰
          USE_SMTP: ${{ secrets.USE_SMTP }}
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_SECURE: ${{ secrets.SMTP_SECURE }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          
          # æ³¨æ„ï¼š
          # - SMTP_USER å’Œ SMTP_PASSWORD åº”è¯¥åœ¨ GitHub Secrets ä¸­é…ç½®ï¼Œè€Œä¸æ˜¯ .env æ–‡ä»¶
          # - 163 é‚®ç®±éœ€è¦åœ¨é‚®ç®±è®¾ç½®ä¸­å¼€å¯ SMTP æœåŠ¡å¹¶ç”Ÿæˆæˆæƒç 
          
          EMAIL_SEND_ENABLED: true
          NODE_ENV: production
          LOG_LEVEL: info
          LOG_LLM_OUTPUT: false
          LOG_LLM_STREAM: false
        run: npm start

      - name: Display execution log
        if: always()
        run: |
          echo "ä»»åŠ¡æ‰§è¡Œå®Œæˆ"
          echo "æ£€æŸ¥æ—¥å¿—ä»¥è·å–è¯¦ç»†ä¿¡æ¯"
